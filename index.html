<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#e0f7fa">
  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, addDoc, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD2rYBmr5fu2HEkZJ-6OKUx6XQUcs9Ppg0",
      authDomain: "weather-notify-8bf63.firebaseapp.com",
      projectId: "weather-notify-8bf63",
      storageBucket: "weather-notify-8bf63.firebasestorage.app",
      messagingSenderId: "541861104637",
      appId: "1:541861104637:web:f6307953860e1eaff96794",
      measurementId: "G-B9KXD8XYS6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // Make Firebase services and methods available globally
    window.db = db;
    window.firestoreCollections = {
      collection,
      doc,
      setDoc,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      limit
    };
  </script>
</head>
<body>
  <div id="bg-animation" class="background"></div>

  <!-- Mood Modal (glassmorphic, animated) -->
  <div id="mood-modal" class="mood-modal hidden">
    <div class="mood-modal-content" onclick="event.stopPropagation();">
      <h3>Select Your Mood</h3>
      <div class="mood-options">
        <div class="mood-option" onclick="selectMood('happy')">😊</div>
        <div class="mood-option" onclick="selectMood('tired')">😴</div>
        <div class="mood-option" onclick="selectMood('loved')">😍</div>
        <div class="mood-option" onclick="selectMood('missing')">😢</div>
      </div>
      <button class="close-mood-modal" onclick="closeMoodModal()">Close</button>
    </div>
  </div>

  <!-- Connect Button and Modal -->
  <div class="connect-button" onclick="openConnectModal()">🔗</div>
  
  <div id="connect-modal" class="modal hidden">
    <div class="modal-content" onclick="event.stopPropagation();">
      <h3>Connect with Partner</h3>
      <div class="token-inputs">
        <div class="input-group">
          <label for="myToken">Your Token:</label>
          <input type="text" id="myToken" placeholder="idlidosa" />
        </div>
        <div class="input-group">
          <label for="partnerToken">Partner's Token:</label>
          <input type="text" id="partnerToken" placeholder="baabbyy" />
        </div>
      </div>
      <div class="connection-status" id="connectionStatus">Not Connected</div>
      <button onclick="connectWithPartner()" class="connect-btn">Connect</button>
      <button class="close-modal" onclick="closeConnectModal()">Close</button>
    </div>
  </div>

  <div class="weather-container">
    <h2 id="city">Loading location...</h2>
    <div id="weather-icon" onclick="tapWeather()" ondblclick="openMoodModal()">⛅</div>
    <h1 id="temp">--°C</h1>
    <p id="condition">Fetching weather...</p>
    <small id="details">Winds: -- | Humidity: --</small>

    <!-- Forecast Row with Animations -->
    <div class="forecast-row">
      <div class="forecast-item" onclick="triggerSecretAnimation('hearts')">
        <span class="forecast-time">6h</span>
        <span class="forecast-icon">🌤️</span>
        <span class="forecast-temp">24°</span>
      </div>
      <div class="forecast-item" onclick="triggerSecretAnimation('sparkles')">
        <span class="forecast-time">12h</span>
        <span class="forecast-icon">☀️</span>
        <span class="forecast-temp">27°</span>
      </div>
      <div class="forecast-item" onclick="triggerSecretAnimation('rain-hearts')">
        <span class="forecast-time">18h</span>
        <span class="forecast-icon">🌧️</span>
        <span class="forecast-temp">21°</span>
      </div>
    </div>

    <div class="hourly-forecast glassmorphic">
      <div id="hourly-bar" class="hourly-bar wide">
        <div class="hour-item" data-hour="0"><span class="hour-label">12 am</span><span class="hour-temp">29°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="1"><span class="hour-label">1 am</span><span class="hour-temp">29°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="2"><span class="hour-label">2 am</span><span class="hour-temp">29°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="3"><span class="hour-label">3 am</span><span class="hour-temp">29°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="4"><span class="hour-label">4 am</span><span class="hour-temp">30°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="5"><span class="hour-label">5 am</span><span class="hour-temp">30°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="6"><span class="hour-label">6 am</span><span class="hour-temp">31°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="7"><span class="hour-label">7 am</span><span class="hour-temp">31°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="8"><span class="hour-label">8 am</span><span class="hour-temp">32°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="9"><span class="hour-label">9 am</span><span class="hour-temp">32°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="10"><span class="hour-label">10 am</span><span class="hour-temp">33°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="11"><span class="hour-label">11 am</span><span class="hour-temp">33°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="12"><span class="hour-label">12 pm</span><span class="hour-temp">34°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="13"><span class="hour-label">1 pm</span><span class="hour-temp">34°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="14"><span class="hour-label">2 pm</span><span class="hour-temp">34°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="15"><span class="hour-label">3 pm</span><span class="hour-temp">33°</span><span class="hour-icon">🌥️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="16"><span class="hour-label">4 pm</span><span class="hour-temp">32°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="17"><span class="hour-label">5 pm</span><span class="hour-temp">32°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="18"><span class="hour-label">6 pm</span><span class="hour-temp">31°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="19"><span class="hour-label">7 pm</span><span class="hour-temp">31°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="20"><span class="hour-label">8 pm</span><span class="hour-temp">31°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="21"><span class="hour-label">9 pm</span><span class="hour-temp">30°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="22"><span class="hour-label">10 pm</span><span class="hour-temp">30°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
        <div class="hour-item" data-hour="23"><span class="hour-label">11 pm</span><span class="hour-temp">30°</span><span class="hour-icon">🌧️</span><div class="availability-icons"></div></div>
      </div>
    </div>
    
    <!-- Availability Selection Panel -->
    <div id="availability-panel" class="availability-panel hidden">
      <div class="availability-panel-content" onclick="event.stopPropagation();">
        <h3>Set Your Availability</h3>
        <div class="availability-options">
          <div id="call-option" class="availability-option" data-type="call">
            <div class="availability-icon">☀️</div>
            <div class="availability-label">Available for Call</div>
          </div>
          <div id="text-option" class="availability-option" data-type="text">
            <div class="availability-icon">☁️</div>
            <div class="availability-label">Available for Text</div>
          </div>
        </div>
        <div class="availability-actions">
          <button id="clear-availability" class="clear-availability">Clear Selection</button>
          <button class="close-availability-panel" onclick="closeAvailabilityPanel()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Animation Container -->
  <div id="floating-animations" class="animation-layer"></div>

  <!-- Enhanced Secret Message Buttons -->
  <div class="secret-buttons">
    <button onclick="sendAlert('sunny')" title="Normal Priority Alert">☀️</button>
    <button onclick="sendAlert('rain')" title="Semi-Important Alert">🌧️</button>
    <button onclick="sendAlert('storm')" title="Urgent Alert">⛈️</button>
  </div>

  <script src="main.js"></script>
  <script>
    // Mood modal open/close animation
    function openMoodModal() {
      const modal = document.getElementById('mood-modal');
      modal.classList.remove('hidden');
      modal.classList.add('show');
      setTimeout(() => {
        modal.classList.add('visible');
      }, 10);
      modal.onclick = function(e) {
        if (e.target === modal) {
          closeMoodModal();
        }
      };
    }

    function closeMoodModal() {
      const modal = document.getElementById('mood-modal');
      modal.classList.remove('visible');
      setTimeout(() => {
        modal.classList.remove('show');
        modal.classList.add('hidden');
      }, 300);
    }

    function selectMood(mood) {
      closeMoodModal();
      sendMood(mood);
    }
  </script>
</body>
</html>